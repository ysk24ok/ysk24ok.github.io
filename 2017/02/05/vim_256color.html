<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="author" content="ysk24ok">
  
  <meta name="description" content="vimの256色対応の方法について改めて調べてみた。自分の結論としては、.vimrcで設定するのではなく`$TERM`を適切に設定すればよい（間違っている可能性ももちろんある）。">
  <meta property="og:description" content="vimの256色対応の方法について改めて調べてみた。自分の結論としては、.vimrcで設定するのではなく`$TERM`を適切に設定すればよい（間違っている可能性ももちろんある）。">
  
  <meta property="og:image" content="https://ysk24ok.github.io/assets/images/profile.jpeg">
  <meta property="og:title" content="vimの256色対応させるのにset t_Co=256は必要ない">
  <meta property="og:url" content="https://ysk24ok.github.io/2017/02/05/vim_256color.html">
  <meta property="og:type" content="article">
  <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- MathJax -->
  <!-- http://docs.mathjax.org/en/latest/start.html#secure-access-to-the-cdn -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(','\\)'] ],
        processEscapes: true
      }
    });
  </script>
  <script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!-- bootstrap -->
  <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css">
  <script src="/assets/js/jquery-2.1.4.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <!-- github.io default -->
  <link rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/github-dark.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
  <!-- syntax highlight css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" media="screen">
  <!-- My customized css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/linkpreview.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css" media="screen">
  <!-- RSS -->
  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="ysk24ok.github.io" />

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131519041-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-131519041-1');
  </script>

  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>vimの256色対応させるのにset t_Co=256は必要ない - ysk24ok.github.io</title>
</head>

  <body>
    <div id="container">
      <div class="inner">
        <header>
  <h1><a href="/">ysk24ok.github.io</a></h1>
</header>
<nav class="navbar navbar-default" role="navigation">
  <ul id="main-navigation" class="nav navbar-nav">
    <li><a href="/">Home</a></li>
    <li><a href="/about">About</a></li>
  </ul>
</nav>

        <div class="post-item">
          <div class="post-header">
  <h1>
    <a href="/2017/02/05/vim_256color.html">vimの256色対応させるのにset t_Co=256は必要ない</a>
  </h1>
  <ul class="post-tags">
    
      <li><a href="#">vim</a></li>
    
      <li><a href="#">terminal</a></li>
    
      <li><a href="#">tmux</a></li>
    
      <li><a href="#">screen</a></li>
    
  </ul>
  
  <div class="post-date">posted on 05 Feb 2017</div>
  
  <hr>
</div>

          <div class="post-content">
            <ul class="social-buttons">
  <!-- hatena bookmark -->
  <li>
    <a href="http://b.hatena.ne.jp/entry/ysk24ok.github.io/2017/02/05/vim_256color.html" class="hatena-bookmark-button" data-hatena-bookmark-title="vimの256色対応させるのにset t_Co=256は必要ない - ysk24ok.github.io" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加">
      <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" />
    </a>
    <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <!-- twitter -->
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
</ul>

            <p>vimの256色対応の方法について改めて調べてみた。<br />
自分の結論としては、.vimrcで設定するのではなく<code class="highlighter-rouge">$TERM</code>を適切に設定すればよい<br />
（間違っている可能性ももちろんある）。</p>

<!-- more -->

<h2 id="前提">前提</h2>

<ul>
  <li>vim : 8.0.295</li>
  <li>Terminal.app : 2.6.1</li>
  <li>iTerm2 : 3.0.13</li>
  <li>tmux : 2.3</li>
  <li>screen : 4.05.00</li>
</ul>

<p>CUIのvimを対象にしているので、GUIのvimだと話が変わるかも。</p>

<h2 id="vimを256色対応させるには">vimを256色対応させるには</h2>

<p>vimは環境変数の<code class="highlighter-rouge">$TERM</code>の値をもとに<code class="highlighter-rouge">term</code> optionの値を決定する。<br />
<code class="highlighter-rouge">term</code> optionの値が決まると<code class="highlighter-rouge">t_Co</code> optionの値も自動的に決まる。</p>

<p>例えば、</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$TERM</span>
xterm-256color
</code></pre></div></div>

<p>のとき、</p>

<div class="language-vimscript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">:</span>echo &amp;term
xterm<span class="m">-256</span><span class="k">color</span>
</code></pre></div></div>

<div class="language-vimscript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">:</span>echo &amp;t_Co
<span class="m">256</span>
</code></pre></div></div>

<p>となる。</p>

<p>また、</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$TERM</span>
xterm
</code></pre></div></div>

<p>のとき、</p>

<div class="language-vimscript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">:</span>echo &amp;term
xterm
</code></pre></div></div>

<div class="language-vimscript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">:</span>echo &amp;t_Co
<span class="m">8</span>
</code></pre></div></div>

<p>となる。</p>

<p>vimを256色対応させるには.vimrcに<code class="highlighter-rouge">set t_Co=256</code>と書くとしているWeb記事は多い
（<a href="http://vim-jp.org/vim-users-jp/2009/08/29/Hack-64.html">これ</a>とか）が、<br />
<strong>実はvimは<code class="highlighter-rouge">$TERM</code>の値を検知してくれるので<code class="highlighter-rouge">t_Co</code>に明示的に値を設定する必要はない（はず）。</strong></p>

<p>なので、<code class="highlighter-rouge">$TERM</code>に256色対応した値を設定しさえすれば良いことになる。</p>

<h2 id="termに256色対応した値を設定するには"><code class="highlighter-rouge">$TERM</code>に256色対応した値を設定するには</h2>

<h3 id="terminal-emulator使用時terminal-multiplexer非使用時">terminal emulator使用時(=terminal multiplexer非使用時)</h3>

<p>terminal emulatorとは、Macで言うところのTerminal.appやiTermを指す。<br />
（terminal emulatorが本当にこういった端末ウィンドウを指すのかは自信がないが、<br />
  恐らく合っているはず。。。）。</p>

<p>基本的にPreferencesからterminal typeを指定する。</p>

<ul>
  <li>Terminal.appの場合
    <ul>
      <li>環境設定 -&gt; プロファイル -&gt; 詳細 -&gt; ターミナルの宣言方法 で<code class="highlighter-rouge">xterm-256color</code>を選ぶ</li>
    </ul>
  </li>
  <li>iTermの場合
    <ul>
      <li>Preferences -&gt; Profiles -&gt; Terminal -&gt; Report Terminal Type で<code class="highlighter-rouge">xterm-256color</code>を選ぶ</li>
    </ul>
  </li>
  <li>Gnomeの場合
    <ul>
      <li>手元にLinuxのGUI環境がないので試せないが、同じくpreferencesからいけるはず</li>
    </ul>
  </li>
</ul>

<p>このterminal typeの値はssh使用時にも引き継がれる（自分が確認した限りそうだった）。</p>

<h3 id="terminal-multiplexer使用時">terminal multiplexer使用時</h3>

<p>screenやtmuxのようなterminal multiplexerの使用時には<code class="highlighter-rouge">$TERM</code>は上書きされる。<br />
そのため各々の設定ファイルに記述する必要がある。</p>

<ul>
  <li>screenの場合
    <ul>
      <li>~/.screenrcに<code class="highlighter-rouge">term "screen-256color"</code>と書く</li>
      <li>ただし256色対応していないscreenの場合、<br />
<code class="highlighter-rouge">$TERM</code>の値こそ<code class="highlighter-rouge">screen-256color</code>になっているものの<br />
実は256色は使用できないという事態に
        <ul>
          <li>256色対応したscreenをソースからmake installする方法は<a href="http://jimsei.hatenablog.com/entry/20111022/1319290431">こちら</a>を参照</li>
          <li>MacならHomebrewを使って、<code class="highlighter-rouge">brew tap homebrew/dupes</code>して<br />
<code class="highlighter-rouge">brew install screen --enable-colors256</code>でインストールできる</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>tmuxの場合
    <ul>
      <li>~/.tmux.confに<code class="highlighter-rouge">set -g default-terminal "screen-256color"</code>と書く</li>
      <li>tmux 2.3だと上の設定なしでも<code class="highlighter-rouge">$TERM</code>が<code class="highlighter-rouge">screen-256color</code>になり256色対応できていた
        <ul>
          <li>terminal emulatorのterminal typeを<code class="highlighter-rouge">xterm-256color</code>以外にしても変わらず</li>
          <li>tmuxのバージョンが新しければ自動的に<code class="highlighter-rouge">screen-256color</code>が設定される？</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="よくある間違い">よくある間違い</h2>

<p><a href="http://stackoverflow.com/questions/15375992/vim-difference-between-t-co-256-and-term-xterm-256color-in-conjunction-with-tmu">ここ</a>や<a href="https://codeyarns.com/2015/03/18/how-to-set-term-to-xterm-256color/">ここ</a>で指摘されている。</p>

<ul>
  <li>.bashrcや.bash_profileに<code class="highlighter-rouge">export TERM=xterm-256color</code>と書く
    <ul>
      <li>terminal multiplexerを使用したときにも設定されてしまう</li>
    </ul>
  </li>
  <li>.vimrcで<code class="highlighter-rouge">set t_Co=256</code>と書く
    <ul>
      <li>256色表示になっていないのに値だけ256ということになりかねない</li>
    </ul>
  </li>
</ul>

<h2 id="terminal-emulatorあるいはmultiplexerやvimが256色対応しているか調べる方法">terminal emulator(あるいはmultiplexer)やvimが256色対応しているか調べる方法</h2>

<p><a href="http://adragoona.hatenablog.com/entry/2014/11/03/152539">この記事</a>を参照。<br />
256colors2.plがリンク切れなので<a href="http://scie.nti.st/dist/256colors2.pl">こちら</a>から。</p>

<h2 id="参考url">参考URL</h2>

<ul>
  <li><a href="http://stackoverflow.com/questions/15375992/vim-difference-between-t-co-256-and-term-xterm-256color-in-conjunction-with-tmu">terminal - Vim: Difference between t_Co=256 and term=xterm-256color in conjunction with TMUX - Stack Overflow</a></li>
  <li><a href="https://codeyarns.com/2015/03/18/how-to-set-term-to-xterm-256color/">How to set TERM to xterm-256color – Code Yarns</a></li>
  <li><a href="http://vim-jp.org/vim-users-jp/2009/08/29/Hack-64.html">vim-jp » Hack #64: 256色ターミナルでVimを使用する</a></li>
  <li><a href="http://scie.nti.st/dist/256colors2.pl">256colors2.pl</a></li>
  <li><a href="http://adragoona.hatenablog.com/entry/2014/11/03/152539">MacのTerminalとvimで256色の確認 - adragoonaの日記</a></li>
  <li><a href="http://jimsei.hatenablog.com/entry/20111022/1319290431">256色対応 gnu-screen 4.1.0 インストール - _J Blog</a></li>
</ul>

            <ul class="social-buttons">
  <!-- hatena bookmark -->
  <li>
    <a href="http://b.hatena.ne.jp/entry/ysk24ok.github.io/2017/02/05/vim_256color.html" class="hatena-bookmark-button" data-hatena-bookmark-title="vimの256色対応させるのにset t_Co=256は必要ない - ysk24ok.github.io" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加">
      <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" />
    </a>
    <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <!-- twitter -->
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
</ul>

          </div>
        </div>
        <footer>
  This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
</footer>

      </div>
    </div>
  </body>
</html>
