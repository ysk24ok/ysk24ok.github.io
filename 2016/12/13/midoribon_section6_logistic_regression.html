<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="author" content="ysk24ok">
  
  <meta name="description" content="みどりぼん第6章のロジスティック回帰について">
  <meta property="og:description" content="みどりぼん第6章のロジスティック回帰について">
  
  <meta property="og:image" content="https://ysk24ok.github.io/assets/images/profile.jpeg">
  <meta property="og:title" content="みどりぼん 第6章 ロジスティック回帰">
  <meta property="og:url" content="https://ysk24ok.github.io/2016/12/13/midoribon_section6_logistic_regression.html">
  <meta property="og:type" content="article">
  <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- MathJax -->
  <!-- http://docs.mathjax.org/en/latest/start.html#secure-access-to-the-cdn -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(','\\)'] ],
        processEscapes: true
      }
    });
  </script>
  <script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!-- bootstrap -->
  <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css">
  <script src="/assets/js/jquery-2.1.4.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <!-- github.io default -->
  <link rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/github-dark.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
  <!-- syntax highlight css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" media="screen">
  <!-- My customized css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/linkpreview.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css" media="screen">
  <!-- RSS -->
  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="ysk24ok.github.io" />

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131519041-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-131519041-1');
  </script>

  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>みどりぼん 第6章 ロジスティック回帰 - ysk24ok.github.io</title>
</head>

  <body>
    <div id="container">
      <div class="inner">
        <header>
  <h1><a href="/">ysk24ok.github.io</a></h1>
</header>
<nav class="navbar navbar-default" role="navigation">
  <ul id="main-navigation" class="nav navbar-nav">
    <li><a href="/">Home</a></li>
    <li><a href="/about">About</a></li>
  </ul>
</nav>

        <div class="post-item">
          <div class="post-header">
  <h1>
    <a href="/2016/12/13/midoribon_section6_logistic_regression.html">みどりぼん 第6章 ロジスティック回帰</a>
  </h1>
  <ul class="post-tags">
    
      <li><a href="#">midoribon</a></li>
    
      <li><a href="#">GLM</a></li>
    
      <li><a href="#">Japanese</a></li>
    
  </ul>
  
  <div class="post-date">posted on 13 Dec 2016</div>
  
  <hr>
</div>

          <div class="post-content">
            <ul class="social-buttons">
  <!-- hatena bookmark -->
  <li>
    <a href="http://b.hatena.ne.jp/entry/ysk24ok.github.io/2016/12/13/midoribon_section6_logistic_regression.html" class="hatena-bookmark-button" data-hatena-bookmark-title="みどりぼん 第6章 ロジスティック回帰 - ysk24ok.github.io" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加">
      <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" />
    </a>
    <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <!-- twitter -->
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
</ul>

            <p><a href="http://hosho.ees.hokudai.ac.jp/~kubo/ce/IwanamiBook.html">みどりぼん</a>第6章のロジスティック回帰についてまとめた。</p>

<!-- more -->

<h1 id="二項分布">二項分布</h1>

<p>二項分布の確率分布は以下の式で表される。</p>

<script type="math/tex; mode=display">p(y|N,q)={}_{N}C_{y} q^{y}(1-q)^{N-y}=\binom{N}{y} q^{y}(1-q)^{N-y}</script>

<p>$p(y|N,q)$は事象の正規確率が$q$であるときに$N$個中の$y$個で事象が生起する確率である。</p>

<h1 id="ロジスティック回帰">ロジスティック回帰</h1>

<p>個体$i$における生起確率$q_{i}$はロジットリンク関数と線形予測子を使って以下のように表される。</p>

<script type="math/tex; mode=display">\log \cfrac{q_{i}}{1-q_{i}}=\beta_{1}+\beta_{2}x_{i}+\beta_{3}f_{i}</script>

<p>ロジット関数の逆関数であるロジスティック関数を使うと、生起確率$q_i$は</p>

<script type="math/tex; mode=display">q_{i}=\cfrac{1}{1+\exp(-z_{i})}\quad(z_{i}=\beta_{1}+\beta_{2}x_{i}+\beta_{3}f_{i})</script>

<p>と表される。</p>

<p>尤度関数は</p>

<script type="math/tex; mode=display">L(\{\beta_{j}\})=\prod_{i} \binom {N_{i}}{y_{i}}q_{i}^{y_{i}}(1-q_{i})^{N_{i}-y_{i}}</script>

<p>となり、対数尤度関数は</p>

<script type="math/tex; mode=display">\log L(\{\beta_{j}\})=\sum_{i} \left( \log\binom {N_{i}}{y_{i}} + y_{i} \log q_{i} + (1-y_{i})\log (1-q_{i}) \right)</script>

<p>となる。</p>

<p>オッズ比（種子が生存する確率/種子が生存しない確率）は</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\cfrac{q_{i}}{1-q_{i}}
&=\exp \left( \beta_{1}+\beta_{2}x_{i}+\beta_{3}f_{i} \right)  \\
&=\exp(\beta_{1})\exp(\beta_{2}x_{i})\exp(\beta_{3}f_{i})
\end{align} %]]></script>

<p>となり、説明変数が1単位増加するとオッズは何倍になる、と表すことができる。</p>

<h1 id="ロジスティック回帰と勾配降下法">ロジスティック回帰と勾配降下法</h1>

<p>ここでは記号を変え、はじパタ6.4に基づく。</p>

<p>訓練サンプル$i(0 \leq i \leq N)$の特徴ベクトルを$\boldsymbol{x}_{i}$、ラベルを$t_{i}$とすると、<br />
負の対数尤度関数は以下の式で表される。</p>

<script type="math/tex; mode=display">\mathcal{L}(\pi_{1},\cdots,\pi_{N})=-\ln L(\pi_{1},\cdots,\pi_{N})=-\sum_{i=1}^{N} \left( t_{i} \ln \pi_{i} + (1-t_{i})\ln (1-\pi_{i}) \right)</script>

<p>ただし、$\pi$は二項分布のパラメータであり、sigmoid関数と係数ベクトル$\boldsymbol{\omega}$と$\boldsymbol{x}$を用いて、</p>

<script type="math/tex; mode=display">\pi_{i}=\sigma(\boldsymbol{x}_{i})=\cfrac{1}{1+\exp(-\boldsymbol{\omega}^{T}\boldsymbol{x}_{i})}</script>

<p>と表される。</p>

<p>$\boldsymbol{\omega}$の成分$j$で$\mathcal{L}$を偏微分すると、</p>

<script type="math/tex; mode=display">\cfrac{\partial \mathcal{L}}{\partial \omega_{j}}=-\sum_{i=1}^{N} \left( \cfrac{t_{i}}{\pi_{i}}\cfrac{\partial \pi_{i}}{\partial \omega_{j}} - \cfrac{1-t_{i}}{1-\pi_{i}}\cfrac{\partial \pi_{i}}{\partial \omega_{j}} \right)</script>

<p>$\frac{d\sigma(t)}{dt}=\sigma(t)\left(1-\sigma(t)\right)$なので、$\phi=\boldsymbol{\omega^{T}}\boldsymbol{x}_{i}$とすると、</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\cfrac{\partial \pi_{i}}{\partial \omega_{j}}
&=\cfrac{\partial \pi_{i}}{\partial \phi} \cdot \cfrac{\partial \phi}{\partial \omega_{j}} \\
&=\pi_{i}(1-\pi_{i}) \cdot x_{ij}
\end{align} %]]></script>

<!-- この式変形合ってる？ -->

<p>よって、</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\cfrac{\partial \mathcal{L}}{\partial \omega_{j}}
&=-\sum_{i=1}^{N} x_{ij} \left(\cfrac{t_{i}}{\pi_{i}} \pi_{i}(1-\pi_{i}) - \cfrac{1-t_{i}}{1-\pi_{i}} \pi_{i}(1-\pi_{i}) \right)  \\
&=\sum_{i=1}^{N} x_{ij} \left( \pi_{i}-t_{i} \right)
\end{align} %]]></script>

<p>$\boldsymbol{\omega}$の全成分で偏微分すると</p>

<script type="math/tex; mode=display">\cfrac{\partial \mathcal{L}}{\partial \boldsymbol{\omega}}=\sum_{i=1}^{N} \boldsymbol{x}_{i} \left( \pi_{i}-t_{i} \right)</script>

<p>最急降下法による更新式は</p>

<script type="math/tex; mode=display">\boldsymbol{\omega} \leftarrow \boldsymbol{\omega} - \eta \sum_{i=1}^{N} \boldsymbol{x}_{i} (\pi_{i}-t_{i})</script>

<p>確率的勾配降下法による更新式は</p>

<script type="math/tex; mode=display">\boldsymbol{\omega} \leftarrow \boldsymbol{\omega} - \eta \boldsymbol{x}_{i} (\pi_{i}-t_{i})</script>

<h1 id="生存種子数のモデリング">生存種子数のモデリング</h1>

<p><a href="http://hosho.ees.hokudai.ac.jp/~kubo/stat/iwanamibook/fig/binomial/data4a.csv">本書で使用されていたサンプルデータ</a>を使って、生存種子数をモデリングする。<br />
体サイズと施肥処理の有無をベースの説明変数とし、</p>

<ul>
  <li>交互作用項なし</li>
  <li>交互作用項あり</li>
</ul>

<p>の2つのモデルを比較したところ、交互作用項ありのモデルの方がAICが悪化した。<br />
このことから、交互作用項を加えてもモデルが複雑になるだけで予測性能は向上しないことがわかる。</p>

<script src="https://gist.github.com/ysk24ok/9d6a6420a1ed679cbe93dc26273e3743.js"></script>

<h2 id="まとめ">まとめ</h2>

<ul>
  <li>「$N$個の観察対象のうち$k$個で反応が見られた」というデータは二項分布で表され<br />
ロジットリンク関数と線形予測子を組み合わせたロジスティック回帰でモデリングする</li>
  <li>交互作用項はむやみに使うべきではない
    <ul>
      <li>交互作用項を含んだモデルがAIC最良になることもあるが、<br />
ニセの交互作用で辻褄合わせをしているだけの可能性もあるので<br />
「個体差」「場所差」の効果を表せるGLMを使う</li>
    </ul>
  </li>
</ul>

<h2 id="参考文献サイト">参考文献・サイト</h2>

<ul>
  <li><a href="http://hosho.ees.hokudai.ac.jp/~kubo/ce/IwanamiBook.html">データ解析のための統計モデリング入門</a> 第6章</li>
  <li><a href="https://www.morikita.co.jp/books/book/2235">はじめてのパターン認識</a> 6.4</li>
  <li><a href="http://gihyo.jp/dev/serial/01/machine-learning/0018">第18回　ロジスティック回帰：機械学習 はじめよう｜gihyo.jp … 技術評論社</a></li>
  <li><a href="http://gihyo.jp/dev/serial/01/machine-learning/0019">第19回　ロジスティック回帰の学習：機械学習 はじめよう｜gihyo.jp … 技術評論社</a></li>
  <li><a href="http://nbviewer.jupyter.org/gist/mitmul/9283713">https://nbviewer.jupyter.org/gist/mitmul/9283713</a></li>
</ul>

            <ul class="social-buttons">
  <!-- hatena bookmark -->
  <li>
    <a href="http://b.hatena.ne.jp/entry/ysk24ok.github.io/2016/12/13/midoribon_section6_logistic_regression.html" class="hatena-bookmark-button" data-hatena-bookmark-title="みどりぼん 第6章 ロジスティック回帰 - ysk24ok.github.io" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加">
      <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" />
    </a>
    <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <!-- twitter -->
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
</ul>

          </div>
        </div>
        <footer>
  This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
</footer>

      </div>
    </div>
  </body>
</html>
