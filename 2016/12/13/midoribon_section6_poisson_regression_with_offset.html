<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="author" content="ysk24ok">
  
  <meta name="description" content="みどりぼん第6章の割算値モデリングのためのオフセット項について">
  <meta property="og:description" content="みどりぼん第6章の割算値モデリングのためのオフセット項について">
  
  <meta property="og:image" content="https://ysk24ok.github.io/assets/images/profile.jpeg">
  <meta property="og:title" content="みどりぼん 第6章 割算値モデリングのためのオフセット項">
  <meta property="og:url" content="https://ysk24ok.github.io/2016/12/13/midoribon_section6_poisson_regression_with_offset.html">
  <meta property="og:type" content="article">
  <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- MathJax -->
  <!-- http://docs.mathjax.org/en/latest/start.html#secure-access-to-the-cdn -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(','\\)'] ],
        processEscapes: true
      }
    });
  </script>
  <script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!-- bootstrap -->
  <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css">
  <script src="/assets/js/jquery-2.1.4.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <!-- github.io default -->
  <link rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/github-dark.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
  <!-- syntax highlight css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" media="screen">
  <!-- My customized css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/linkpreview.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css" media="screen">
  <!-- RSS -->
  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="ysk24ok.github.io" />

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131519041-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-131519041-1');
  </script>

  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>みどりぼん 第6章 割算値モデリングのためのオフセット項 - ysk24ok.github.io</title>
</head>

  <body>
    <div id="container">
      <div class="inner">
        <header>
  <h1><a href="/">ysk24ok.github.io</a></h1>
</header>
<nav class="navbar navbar-default" role="navigation">
  <ul id="main-navigation" class="nav navbar-nav">
    <li><a href="/">Home</a></li>
    <li><a href="/about">About</a></li>
  </ul>
</nav>

        <div class="post-item">
          <div class="post-header">
  <h1>
    <a href="/2016/12/13/midoribon_section6_poisson_regression_with_offset.html">みどりぼん 第6章 割算値モデリングのためのオフセット項</a>
  </h1>
  <ul class="post-tags">
    
      <li><a href="#">midoribon</a></li>
    
      <li><a href="#">GLM</a></li>
    
      <li><a href="#">Japanese</a></li>
    
  </ul>
  
  <div class="post-date">posted on 13 Dec 2016</div>
  
  <hr>
</div>

          <div class="post-content">
            <ul class="social-buttons">
  <!-- hatena bookmark -->
  <li>
    <a href="http://b.hatena.ne.jp/entry/ysk24ok.github.io/2016/12/13/midoribon_section6_poisson_regression_with_offset.html" class="hatena-bookmark-button" data-hatena-bookmark-title="みどりぼん 第6章 割算値モデリングのためのオフセット項 - ysk24ok.github.io" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加">
      <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" />
    </a>
    <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <!-- twitter -->
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
</ul>

            <p><a href="http://hosho.ees.hokudai.ac.jp/~kubo/ce/IwanamiBook.html">みどりぼん</a>第6章の割算値モデリングのためのオフセット項についてまとめた。</p>

<!-- more -->

<p>使用したデータは<a href="http://hosho.ees.hokudai.ac.jp/~kubo/stat/iwanamibook/fig/binomial/data4b.csv">こちら</a>。
また、jupyter notebookは<a href="https://nbviewer.jupyter.org/gist/ysk24ok/77230fa47ee0cf2b229ca83b0ff826ee">こちら</a>。</p>

<h2 id="割算値モデリングのためのオフセット項">割算値モデリングのためのオフセット項</h2>

<ul>
  <li>調査地$i$ごとにその面積$A_{i}$が異なる</li>
  <li>調査地$i$における植物個体数$y_{i}$を記録</li>
  <li>調査地$i$の明るさ$x_{i}$から人口密度$z_{i}$を推定する</li>
</ul>

<p>平均個体数を$\lambda_{i}$とすると、面積$A_{i}$と人口密度$z_{i}$の関係は</p>

<script type="math/tex; mode=display">\cfrac{\lambda_{i}}{A_{i}}=z_{i}</script>

<p>と表されるので、</p>

<p>平均個体数$\lambda_{i}$を対数リンク関数と線形予測子を使って以下の式で表される。</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\lambda_{i}
&=A_{i}\exp(\beta_{1}+\beta_{2}x_{i})  \\
&=\exp (\beta_{1}+\beta_{2}x_{i}+\log A_{i})
\end{align} %]]></script>

<p>このように面積をオフセット項として扱うことで、
人口密度のような割算値を直接目的変数とすることなくモデリングすることが可能となる。</p>

<h2 id="観測データの概要">観測データの概要</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.font_manager</span> <span class="k">as</span> <span class="n">fm</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'~/Downloads/data4b.csv'</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s">'/Library/Fonts/Yu Gothic Medium.otf'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class <span class="s1">'pandas.core.frame.DataFrame'</span><span class="o">&gt;</span>
RangeIndex: 100 entries, 0 to 99
Data columns <span class="o">(</span>total 3 columns<span class="o">)</span>:
y    100 non-null int64
x    100 non-null float64
A    100 non-null float64
dtypes: float64<span class="o">(</span>2<span class="o">)</span>, int64<span class="o">(</span>1<span class="o">)</span>
memory usage: 2.4 KB

                y           x           A
count  100.000000  100.000000  100.000000
mean    48.090000    0.514100   10.468000
std     17.137056    0.188573    2.927262
min     13.000000    0.050000    3.500000
25%     36.000000    0.400000    8.800000
50%     46.000000    0.515000   10.300000
75%     59.500000    0.642500   12.150000
max     95.000000    0.990000   17.400000
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.0-0.2'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'w'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.2-0.4'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'y'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.4-0.6'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.6-0.8'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.8-1.0'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'upper left'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'調査地の面積 A'</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'植物の個体数 y'</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'散布図'</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/midoribon/06/output_2_1_offset.png" alt="png" /></p>

<h2 id="オフセット項つきポワソン回帰でfitting">オフセット項つきポワソン回帰でfitting</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="n">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="n">smf</span>
<span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s">'y ~ x'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">),</span>
              <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">())</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                 Generalized Linear Model Regression Results                  
<span class="o">==============================================================================</span>
Dep. Variable:                      y   No. Observations:                  100
Model:                            GLM   Df Residuals:                       98
Model Family:                 Poisson   Df Model:                            1
Link Function:                    log   Scale:                             1.0
Method:                          IRLS   Log-Likelihood:                <span class="nt">-323</span>.17
Date:                Tue, 13 Dec 2016   Deviance:                       81.608
Time:                        07:10:13   Pearson chi2:                     81.5
No. Iterations:                     7                                         
<span class="o">==============================================================================</span>
                 coef    std err          z      P&gt;|z|      <span class="o">[</span>95.0% Conf. Int.]
<span class="nt">------------------------------------------------------------------------------</span>
Intercept      0.9731      0.045     21.600      0.000         0.885     1.061
x              1.0383      0.078     13.364      0.000         0.886     1.191
<span class="o">==============================================================================</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">gen_ytest</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Arange</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
    <span class="nb">xrange</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Arange</span><span class="p">))]</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'x'</span><span class="p">:</span> <span class="nb">xrange</span><span class="p">,</span> <span class="s">'A'</span><span class="p">:</span> <span class="n">Arange</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">A</span><span class="p">))</span>

<span class="n">Arange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">ytest_01</span> <span class="o">=</span> <span class="n">gen_ytest</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">Arange</span><span class="p">)</span>
<span class="n">ytest_03</span> <span class="o">=</span> <span class="n">gen_ytest</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">Arange</span><span class="p">)</span>
<span class="n">ytest_05</span> <span class="o">=</span> <span class="n">gen_ytest</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">Arange</span><span class="p">)</span>
<span class="n">ytest_07</span> <span class="o">=</span> <span class="n">gen_ytest</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">Arange</span><span class="p">)</span>
<span class="n">ytest_09</span> <span class="o">=</span> <span class="n">gen_ytest</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">Arange</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.0-0.2'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Arange</span><span class="p">,</span> <span class="n">ytest_01</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'x=0.1'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.2-0.4'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Arange</span><span class="p">,</span> <span class="n">ytest_03</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'x=0.3'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.4-0.6'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'y'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Arange</span><span class="p">,</span> <span class="n">ytest_05</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'x=0.5'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.6-0.8'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Arange</span><span class="p">,</span> <span class="n">ytest_07</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'g'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'x=0.7'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">A</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)],</span>
           <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="s">'0.8-1.0'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Arange</span><span class="p">,</span> <span class="n">ytest_09</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'x=0.9'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'植物の体サイズ x'</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'生存種子数 y'</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'best'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'散布図'</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/midoribon/06/output_4_1_offset.png" alt="png" /></p>

<h2 id="まとめ">まとめ</h2>

<ul>
  <li>観測値どうしの割算値作成はせず、ロジスティック回帰やオフセット項つき回帰などを用いる</li>
</ul>

<h2 id="参考文献サイト">参考文献・サイト</h2>

<ul>
  <li><a href="http://hosho.ees.hokudai.ac.jp/~kubo/ce/IwanamiBook.html">データ解析のための統計モデリング入門</a> 第6章</li>
</ul>

            <ul class="social-buttons">
  <!-- hatena bookmark -->
  <li>
    <a href="http://b.hatena.ne.jp/entry/ysk24ok.github.io/2016/12/13/midoribon_section6_poisson_regression_with_offset.html" class="hatena-bookmark-button" data-hatena-bookmark-title="みどりぼん 第6章 割算値モデリングのためのオフセット項 - ysk24ok.github.io" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加">
      <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" />
    </a>
    <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <!-- twitter -->
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
</ul>

          </div>
        </div>
        <footer>
  This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
</footer>

      </div>
    </div>
  </body>
</html>
